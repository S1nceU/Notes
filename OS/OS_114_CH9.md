- File System
# Interface
## File Concept
- File 
	- a logical storage unit create by OS
	- Type 
		- Data
		- Program
- File attributes
	- File name
	- Identifier
		- unique tag or number by the file system
	- Type
	- Location
	- Size
		- byte
	- Protection
	- Time, date, and user identification
		- time stamp
## File operations
- Operation
	- Create
	- Write
		- indicate where in the file the system will begin to write
	- Read
		- read a file that the system starts at the position indicated
	- Reposition within file
		- seek
		- 改寫 read/write 的位置
	- Delete
		- free up the space
	- Truncate/Concatenate
		- reduce the length of a file, splitting a file
		- concat two files together
- Open-file table
	- each process has an open-file table
	- track the files it has opened
	- 有讀寫位置、檔案權限
	- 每個 process 追蹤開啟檔案的表格
	
- System-wide table
	- a.k.a global file table
	- 包含所有 processes 打開的 file
	- 有多少 instance、多少 process 有打開檔案、file 的狀態以及屬性
	- 檔案的磁碟位置、存取權限、檔案被開啟的次數

![[Pasted image 20251215164202.png|500]]
- process 開檔案後，會在 system-wide table 尋找或是 register 一個
- 然後在到 open-file table register 
- 同一個檔案可以被多個 process 開啟，但需要 System-wide table 設定安全性、同步問題、跟蹤 process

## Access methods
### Sequential access
- Read/write next block
- Reset 
	- repositioning the file pointer to the beginning
- Skip/rewind $n$ records
	- 跳過或是倒帶
- Ex
	- Video tape
	- Cassette tape
### Direct (relative) access
- Access an element at a arbitrary (隨意的) position
- 用 block 編號指定需要訪問的資料位置
- 比較圖
![[Pasted image 20251215170813.png|500]]
### Index access
- 會有 pointer 指向檔案區塊
- 若檔案越大，則需要指向檔案中的內容就越多，則 index file 則會變大

![[Pasted image 20251215171555.png|500]]
## Directory structure
- Directory 是一組 nodes 的集合
- 作為索引，指向實際的檔案
- 會存在硬碟當中
- Operation
	- Search
	- Create 
	- Delete
	- List a directory
	- Rename
	- Traverse the file system
		- 遍歷檔案系統
### Single-level directory
- 所有資料的索引都存在一個 single directory
![[Pasted image 20251215175304.png|500]]
- Problem
	- Naming
		- 不能有同樣的檔名，檔名全域唯一
	- Grouping
		- 難以分類檔案，因為都在同一層
	- Poor efficiency
		- 檔案越多，要遍歷的 index 就越多，效率慢
- 易實作，體驗差
### Two-level directory
- 用使用者分層，解決同名以及效率差問題
- Master File Directory (MFD)、User File Directory (UFD)
![[Pasted image 20251215175830.png|500]]
- Problem
	- Grouping
		- 依然難解決資料分類問題
	- 單一使用者效率差
		- 在單一使用者資料變多，則該使用者的遍歷則會變慢
### Tree-structured directory
- 用樹結構，建造資料樹
![[Pasted image 20251215180805.png|500]]
- 多層目錄定義位置
- Path
	- Absolute 絕對
	- Relative 相對
- Operation
	- mkdir 創建子目錄
	- 刪除則會刪掉整個子樹
- 有分類的能力，管理成本低
- 因為可以分類多層，則可有效率的查詢
### Acyclic-graph directory
- 無環有序圖，不會有迴圈
![[Pasted image 20251215181206.png|500]]
- 讓不同專案可以共享目錄以及檔案
- Problem
	- 同一個檔案會有多條絕對路徑
	- 刪除檔案時，需要注意是否還有其他條路徑指向檔案，否則會報檔案遺失或是 memory leak
		- 可以用一個 counter 做為指向的數量，為 0 時才可以完全刪除檔案
### General-graph directory
- 有環有序圖，可能有迴圈
![[Pasted image 20251215205756.png|500]]
- 允許檔案互相指向，但可能會有 cycle
- Problem
	- Cycle
		- 導致路徑解析時會有無限迴圈
		- 在刪除檔案時，Refence Counter 不會有 0 的時候，導致無法刪除
	- 解決辦法
		- Garbage collection
			- 用定期機制判定是否有檔案節點無法被訪問或到達，可以防止循環中有洞
		- Cycle detection
			- 建立連結的時候，用演算法判定是否有 Cycle，若有則拒絕
## File-System Mounting
- 一個 File system 需要訪問時，需要先被 Mounting
![[Pasted image 20251215211243.png|500]]
- Mounting
	- 將一個 File system 接上在主目錄的一個節點中 (Mount Point)
- Timing
	- Boot time
		- 開機時，自動掛載
	- Automatically at run-time
		- 執行中自動掛載，插 USB 等
	- Manually at run-time
		- 手動掛載，指定掛載點上，掛上自己的 File system
## File Sharing
- 在協作的工作環境、多使用者存取檔案時，會有 File sharing 的機制，管理權限與保護資料
- UID、GID
	- User ID
		- 以**人**的單位辨識權限
	- Group ID
		- 以使用者**群組**辨識權限
- Character
	- Owner
		- 擁有者能做
	- Group
		- 同一群組能做
	- Others
		- 都不屬於能做
## Access-Control and Group
![[Pasted image 20251215212452.png|200]]
![[Pasted image 20251215212505.png|300]]
- Access-Control List (ACL)
	- 檢查訪問請求是否符合權限
	- RWX：Read、Write、eXecute
- 每個檔案會有三組 ACL
	- Owner、Group、Public/Others
- ACL 可以用二進制轉十進制
	- 7 = 4 + 2 + 1 = rwx
	- 6 = 4+2+0 = rw
	- 1 = 0+0+1 = --x
	- chmod 761 = rwxrw---x
- 第一個 d 的意思
	- 是否是**資料夾**
## File Protection
- File owner/creator 可以設定 ACL 存取權限，對於資料作保護政策
- 兩種風險
	- Physical damage 實體損壞 (Reliability)
		- 磁軌、硬碟損毀
		- 可以用 RAID 做保護機制
	- Improper acces 不當存取 (Protection)
		- 有未授權的人讀到機密檔案竄改
		- 可以用驗證機制加上 ACL 阻止事情發生
# Implementation
